#!/bin/sh

set -e

VAULT_PASSWORD_FILE_GLOBS=".vault-password* .vault_password"

# Resolve symlinks in path
cd "$(realpath "$PWD")"

# Find vault password file in current directory and parent ones
while [ "$PWD" != / ]; do
  # Try each of allowed password files
  for g in $VAULT_PASSWORD_FILE_GLOBS; do
    for f in $g; do
      if [ -f "$f" ]; then
        cat "$f"
        exit
      fi
    done
  done

  # Try parent directory
  cd ..
done

# Default to prompt if no password file found
# read -p 'Vault password: ' -s
# echo >&2
# echo "$REPLY"

# Default password to avoid Error! Invalid vault password was provided from script
echo ' '
