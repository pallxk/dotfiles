#!/usr/bin/env bash

set -euxo pipefail

cd ~/.config/clash

# https://mikefarah.gitbook.io/yq/usage/tips-and-tricks#merge-combine-all-documents-into-one
# https://mikefarah.gitbook.io/yq/operators/multiply-merge#merge-flags

docker run --rm -v "$HOME":/mnt -w /mnt/.config/clash \
    mikefarah/yq \
    eval-all \
    '. as $item ireduce ({}; . *+ $item)' \
    config.d/*.yaml \
  | tee config.yaml
